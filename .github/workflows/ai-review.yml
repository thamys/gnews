name: AI Code Review

# Trigger: executa quando um Pull Request é aberto ou atualizado
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    
    # Permissões necessárias para o job
    permissions:
      contents: read          # Permite ler o conteúdo do repositório
      pull-requests: write    # Permite comentar no Pull Request

    steps:
      # Passo 1: Faz checkout do código do repositório
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0      # Busca todo o histórico para análise completa

      # Passo 2: Executa a revisão de código com Gemini AI
      # Documentação completa: https://github.com/sshnaidm/gemini-code-review-action#configuration-options
      - name: Gemini Flash Reviewer
        uses: sshnaidm/gemini-code-review-action@v1
        env:
          # Define a variável de ambiente que a action espera
          GEMINI_API_KEY: ${{ secrets.AI_API_KEY }}
        with:
          # Modelo do Gemini a ser utilizado (Flash é rápido e econômico)
          model: gemini-1.5-flash
          
          # Chave da API do Gemini (IMPORTANTE: usar hífen, não underscore)
          gemini-key: ${{ secrets.AI_API_KEY }}
          
          # Token do GitHub para autenticação (opcional, usa o padrão se omitido)
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
          # Prompt customizado para o revisor de código
          prompt: |
            Aja como um Engenheiro de Segurança Sênior (DevSecOps). 
            Analise o DIFF deste Pull Request buscando:
            1. Vulnerabilidades OWASP Top 10 (especialmente SQL Injection e Insecure Deserialization).
            2. Code Smells e complexidade ciclomática desnecessária.
            3. Aderência às melhores práticas de Java 25 e Spring Boot 3.4.
            4. Responda com comentários técnicos e construtivos diretamente nas linhas do código afetado.
